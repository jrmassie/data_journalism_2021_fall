---
title: "Final data project"
authors: JR 
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Turn off scientific notation
options(scipen=999)

install.packages("ggrepel")
library(tidyverse)
library(janitor)
library(lubridate)
library(ggrepel)
library(sf)

```

Loading data frames 

```{r}

#pulled data from 08/01/2018 to present day to give ourselves the chance to compare numbers from covid times to pre-covid times. 

all_registrations <- read_csv("data/registrations.csv") %>%
  clean_names()

all_activity_reports <- read_csv("data/activity_reports.csv") %>%
  clean_names()




```
Taking a peek at the data


```{r}

glimpse(all_activity_reports)

#Rows: 10,000 and Columns: 19 from glimpse 

glimpse(all_registrations)

#Rows: 9,819 and Columns: 5 from glimpse

#looking to see how many clients each registered lobbyist has had from 2018 to present day

all_registrations %>% 
  group_by(lobbyist_registrant) %>% 
  summarise(total_lobbyists =n()) %>% 
  arrange(desc(total_lobbyists))



```

First I wanted to find education lobbyists so I sorted the data by employer and listed it in descending order. I stored it in a variable so that it would be easier to look through.
```{r}
employers <-
all_registrations %>%
  group_by(employer) %>%
  filter(employer == "Teachers") %>%
  summarize(
    total_employed = n()) %>%
  arrange(desc(total_employed))
  
```
I found it too difficult to parse through the amount of data that was still there so I decided to look online for a list of education lobbyists. I found one on opensecrets.org (https://www.opensecrets.org/federal-lobbying/industries/summary?id=W04&cycle=2021). I downloaded the csv file of education lobbyists and imported it into R.
```{r}
edu_lobby <- read_csv("C:/Users/jerol/OneDrive - University of Maryland/GitHub/Data Journalism/major_assignments/data_analysis/data/os_education.csv")
```
Next I needed to cross reference the education lobbying data and the MD data. I first mutated the edu_lobby data so that the column names I'm merging on would be the same.

```{r}
md_edu_lobby_bad <-
edu_lobby %>%
  left_join(all_registrations, by=c("Client/Parent" = "employer"))
```
This method didn't work because the open secrets data was incomplete and didn't perfectly overlap. Instead I'm now going to try filtering for employers who have names including educational terms in the data. Skimming the educational data from open secrets I included some common terms.

```{r}
md_edu_lobby <-
  all_activity_reports %>%
  filter (str_detect(employer, "Education|University|School|Teach|College|Academic"))
```
Now that I have data that is narrowed in on education I can start to find differences in spending from 2018-2019 to 2020-2021. Since the dates are presented in a range that sometimes spans multiple years, I decided to base the spending off of the initial or starting date of the reporting period. I did so by using more string detects.
```{r}
twenty_twentyone <-
md_edu_lobby %>%
  filter(str_detect(reporting_period, "../../20-../../..|../../21-../../.."))

eighteen_nineteen <-
  md_edu_lobby %>%
  filter(str_detect(reporting_period, "../../18-../../..|../../19-../../.."))

```
Now that we have our separated sets we can do some data analysis to see how it has changed over the past few years. To do that we must first change the total_expenses column from a character to a number.
```{r}
eighteen_nineteen$total_expenses = as.numeric(gsub("[\\$,]", "", eighteen_nineteen$total_expenses))

twenty_twentyone$total_expenses = as.numeric(gsub("[\\$,]", "", twenty_twentyone$total_expenses))
```
2018-2019
```{r}
eighteen_nineteen %>%
summarise(
    sum_expenses = sum(total_expenses),
    mean_expenses = mean(total_expenses),
    median_expenses = median(total_expenses)
  ) %>% 
  arrange(desc(sum_expenses))
```
2020-2021
```{r}
twenty_twentyone %>%
summarise(
    sum_expenses = sum(total_expenses),
    mean_expenses = mean(total_expenses),
    median_expenses = median(total_expenses)
  ) %>% 
  arrange(desc(sum_expenses))
```
There's a significant decrease in the mean and median expenditures from '18-'19 to '20-'21. Mean was cut by more than half, while median was cut exactly in half. However, the sum expenses increased. Considering that the number of variables/education lobbyists increased in the dataset from 83 in '18-'19 to 260 in '20-'21. We can see this by summarizing the number of loans below the median amounts and comparing them.
```{r}
eighteen_nineteen %>%
  filter(total_expenses <= 6000) %>%
  summarize(count=n())
```
In '18-'19 there were 42 lobbyists at or below the median total expenses.
```{r}
twenty_twentyone %>%
  filter(total_expenses <= 6000) %>%
  summarize(count=n())
```
In '20-'21 there were 163. Proportionally, the difference is 42/83~51% and 163/260~63%. That 12% difference likely accounts for the gap.
